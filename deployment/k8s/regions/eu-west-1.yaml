apiVersion: v1
kind: ConfigMap
metadata:
  name: photonic-foundry-eu-west-1-config
  namespace: photonic-foundry
  labels:
    app: photonic-foundry
    region: eu-west-1
    jurisdiction: eu
    compliance: gdpr
data:
  # Regional configuration
  region.name: "eu-west-1"
  region.display.name: "EU West (Ireland)"
  region.timezone: "Europe/Dublin"
  region.jurisdiction: "EU"
  
  # Compliance settings
  compliance.primary: "gdpr"
  compliance.secondary: "eu-ai-act,dma"
  data.residency.required: "true"
  data.export.restrictions: "adequacy-decision-required"
  gdpr.data.controller: "Photonic Foundry EU Ltd"
  gdpr.dpo.contact: "dpo-eu@photonic-foundry.com"
  
  # Resource allocation
  quantum.nodes.min: "3"
  quantum.nodes.max: "40"
  quantum.compute.priority: "high"
  gpu.acceleration: "nvidia-h100"
  
  # Networking
  vpc.cidr: "10.2.0.0/16"
  availability.zones: "eu-west-1a,eu-west-1b,eu-west-1c"
  load.balancer.type: "application"
  
  # Performance targets
  latency.target.ms: "30"
  throughput.target.gops: "1800"
  availability.target: "99.95"
  
  # GDPR specific settings
  gdpr.consent.required: "true"
  gdpr.data.portability: "enabled"
  gdpr.right.to.be.forgotten: "enabled"
  gdpr.data.minimization: "strict"
  gdpr.purpose.limitation: "enforced"
  
  # Monitoring
  monitoring.endpoint: "https://monitoring-eu-west-1.photonic-foundry.com"
  logs.retention.days: "2555"  # 7 years for GDPR compliance
  metrics.granularity: "1m"

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: photonic-foundry-eu-west-1
  namespace: photonic-foundry
  labels:
    app: photonic-foundry
    region: eu-west-1
spec:
  replicas: 3
  selector:
    matchLabels:
      app: photonic-foundry
      region: eu-west-1
  template:
    metadata:
      labels:
        app: photonic-foundry
        region: eu-west-1
        jurisdiction: eu
        compliance: gdpr
    spec:
      nodeSelector:
        kubernetes.io/region: eu-west-1
        node.photonic-foundry.com/quantum-compute: "true"
        node.photonic-foundry.com/gpu-type: nvidia-h100
        node.photonic-foundry.com/gdpr-compliant: "true"
      
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.io/region
                operator: In
                values:
                - eu-west-1
              - key: node.photonic-foundry.com/gdpr-compliant
                operator: In
                values:
                - "true"
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app
                  operator: In
                  values:
                  - photonic-foundry
              topologyKey: kubernetes.io/hostname
      
      tolerations:
      - key: node.photonic-foundry.com/quantum-workload
        operator: Equal
        value: "true"
        effect: NoSchedule
      - key: node.photonic-foundry.com/gdpr-workload
        operator: Equal
        value: "true"
        effect: NoSchedule
      
      containers:
      - name: photonic-foundry
        image: photonic-foundry:1.0.0-amd64
        imagePullPolicy: IfNotPresent
        
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 8443
          name: https
          protocol: TCP
        - containerPort: 9090
          name: metrics
          protocol: TCP
        
        env:
        - name: REGION
          value: "eu-west-1"
        - name: JURISDICTION
          value: "EU"
        - name: COMPLIANCE_PRIMARY
          value: "gdpr"
        - name: DATA_RESIDENCY_REQUIRED
          value: "true"
        - name: GDPR_MODE_ENABLED
          value: "true"
        - name: DATA_EXPORT_RESTRICTIONS
          value: "adequacy-decision-required"
        - name: CONSENT_MANAGEMENT_ENABLED
          value: "true"
        - name: RIGHT_TO_BE_FORGOTTEN_ENABLED
          value: "true"
        
        envFrom:
        - configMapRef:
            name: photonic-foundry-global-config
        - configMapRef:
            name: photonic-foundry-eu-west-1-config
        - secretRef:
            name: photonic-foundry-global-secrets
        
        resources:
          requests:
            cpu: "2000m"
            memory: "4Gi"
            nvidia.com/gpu: "1"
          limits:
            cpu: "6000m"
            memory: "12Gi"
            nvidia.com/gpu: "2"
        
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
            scheme: HTTP
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
            scheme: HTTP
          initialDelaySeconds: 15
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 3
        
        volumeMounts:
        - name: quantum-data
          mountPath: /app/data
        - name: gdpr-audit-logs
          mountPath: /app/logs/gdpr
        - name: consent-records
          mountPath: /app/data/consent
        - name: region-secrets
          mountPath: /app/secrets
          readOnly: true
      
      volumes:
      - name: quantum-data
        persistentVolumeClaim:
          claimName: quantum-data-eu-west-1
      - name: gdpr-audit-logs
        persistentVolumeClaim:
          claimName: gdpr-audit-logs-eu-west-1
      - name: consent-records
        persistentVolumeClaim:
          claimName: consent-records-eu-west-1
      - name: region-secrets
        secret:
          secretName: photonic-foundry-eu-west-1-secrets
          defaultMode: 0400

---
apiVersion: v1
kind: Service
metadata:
  name: photonic-foundry-eu-west-1
  namespace: photonic-foundry
  labels:
    app: photonic-foundry
    region: eu-west-1
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "http"
    service.beta.kubernetes.io/aws-load-balancer-ssl-cert: "arn:aws:acm:eu-west-1:account:certificate/gdpr-compliant-cert"
spec:
  type: LoadBalancer
  selector:
    app: photonic-foundry
    region: eu-west-1
  ports:
  - name: http
    port: 80
    targetPort: 8080
    protocol: TCP
  - name: https
    port: 443
    targetPort: 8443
    protocol: TCP
  - name: metrics
    port: 9090
    targetPort: 9090
    protocol: TCP